$.fn.poptrox=function(t){"use strict";var e,o,i,p,n,a,r,d,s,l,h,c,u,g,f,w,v,x,m,y,C,b=this;if(0==b.length)return b;if(b.length>1){for(e=0;e<b.length;e++)$(b[e]).poptrox(t);return b}function S(){var t,e,i,p,n,r,d,s;l=a.width(),h=a.height(),t=w.outerWidth(!0)-w.width(),e=w.outerHeight(!0)-w.height(),(i=c.map(t=>t.src).indexOf(w.find(".pic").children().attr("src")))>-1&&"image"!=c[i].type?(p=Math.min(l-2*o.windowMargin-t,c[i].width),n=Math.min(h-2*o.windowMargin-e,c[i].height),r=c[i].width/c[i].height,d=p,s=n,d=Math.round(Math.min(d,n*r)),s=Math.round(Math.min(s,p/r))):(d=l-2*o.windowMargin-t,s=h-2*o.windowMargin-e),w.css({minWidth:o.popupWidth,minHeight:o.popupHeight}),v.children().css({maxWidth:d,maxHeight:s})}return o=$.extend({baseZIndex:1e3,fadeSpeed:300,overlayColor:"#000",overlayOpacity:.6,overlayClass:"poptrox-overlay",windowMargin:50,selector:"a",caption:null,parent:"body",popupSpeed:300,popupWidth:200,popupHeight:100,useBodyOverflow:!1,usePopupEasyClose:!0,usePopupForceClose:!1,usePopupLoader:!0,usePopupCloser:!0,usePopupCaption:!1,popupBackgroundColor:"#fff",popupCloserBackgroundColor:"#000",popupCloserTextColor:"#fff",popupCloserTextSize:"20px",popupPadding:10,popupCaptionHeight:60,popupCaptionTextSize:null,popupBlankCaptionText:"(untitled)",popupCloserText:"&#215;",popupLoaderText:"&bull;&bull;&bull;&bull;",popupClass:"poptrox-popup",popupLoaderSelector:".loader",popupCloserSelector:".closer",popupCaptionSelector:".caption",onPopupClose:null,onPopupOpen:null},t),i=$("body"),p="<div>",n=$(p,{class:o.overlayClass}),a=$(window),r=$("#main"),d=$("#header, #zp__admin_module"),s=$(".themeSwitcherControlLink"),c=[],u=0,g=!1,f="poptrox_switch",w=$('<div class="'+o.popupClass+'">'+(o.popupLoaderSelector?'<div class="loader">'+o.popupLoaderText+"</div>":"")+'<div class="pic"></div>'+(o.popupCaptionSelector?'<div class="caption"></div>':"")+(o.popupCloserSelector?'<span class="closer">'+o.popupCloserText+"</span>":"")),v=w.find(".pic"),x=$(),m=w.find(o.popupLoaderSelector),y=w.find(o.popupCaptionSelector),C=w.find(o.popupCloserSelector),a.on("resize orientationchange",function(){S()}),y.on("update",function(t,e){e&&0!=e.length||(e=o.popupBlankCaptionText),y.html(e)}),n.css({position:"fixed",left:0,top:0,zIndex:o.baseZIndex,width:"100%",height:"100%",textAlign:"center",cursor:"pointer"}).appendTo(o.parent).prepend($(p,{css:{display:"inline-block",height:"100%",verticalAlign:"middle"}})).append($(p,{css:{position:"absolute",left:0,top:0,width:"100%",height:"100%",background:o.overlayColor,opacity:o.overlayOpacity}})).hide().on("touchmove",function(){return!1}),w.css({display:"inline-block",verticalAlign:"middle",position:"relative",zIndex:1,cursor:"auto"}).appendTo(n).hide().on("poptrox_next",function(){var t=u+1;t>=c.length&&(t=0),w.trigger(f,[t])}).on("poptrox_previous",function(){var t=u-1;t<0&&(t=c.length-1),w.trigger(f,[t])}).on("poptrox_reset",function(){S(),w.data({width:o.popupWidth,height:o.popupHeight}),m.hide().trigger("stopSpinning"),y.hide(),C.hide(),v.hide(),x.attr("src","").detach()}).on("poptrox_open",function(t,e){if(g)return!0;if(g=!0,o.useBodyOverflow){var p=a.width(),l=innerWidth-p;l&&(d.css("width",p),r.css("overflow-y","scroll"),s.css("left","calc(50% - "+l/2+"px)")),i.css("overflow-y","hidden")}o.onPopupOpen&&o.onPopupOpen(),w.addClass("loading"),n.fadeIn(o.fadeSpeed),w.trigger(f,[e,!0])}).on(f,function(t,e,i){var p,n,a,r;if(!i&&g)return!0;g=!0,w.removeClass("not-image").addClass("loading").css({width:w.data("width"),height:w.data("height")}),y.hide(),x.attr("src")&&x.attr("src",""),x.detach(),p=c[e],x=p.object,v.css("clip-path","inset(50%)").show().append(x),"ajax"==p.type?$.get(p.src,function(t){x.html(t),x.trigger("load")}):x.attr("src",p.src),"image"!=p.type&&(w.addClass("not-image"),x.css({position:"relative",outline:0,zIndex:o.baseZIndex+100,width:p.width,height:p.height})),m.trigger("startSpinning").fadeIn(300),w.show(),x.one("load",function(){S(),m.hide().trigger("stopSpinning");var t=x.width(),i=x.height(),r=function(){y.trigger("update",[p.captionText]).fadeIn(o.fadeSpeed),C.fadeIn(o.fadeSpeed),a&&x.css({height:"auto",aspectRatio:a}),v.css({clipPath:"none",aspectRatio:n}).hide().fadeIn(o.fadeSpeed,function(){g=!1}),u=e,w.removeClass("loading").data({width:t,height:i}).css({width:"auto",height:"auto"})};n&&(t=x.outerWidth(),i=x.outerHeight(),x.css("height","100%")),t==w.data("width")&&i==w.data("height")?r():w.animate({width:t,height:i},o.popupSpeed,"swing",r)}),n="",a="","video"!=p.type&&"audio"!=p.type||(r=p.width+"/"+p.height,"video"==p.type?a=r:n=r,x.one("canplay",function(){x.trigger("load")}))}).on("poptrox_close",function(){if(g&&!o.usePopupForceClose)return!0;g=!0,w.css({"transition-duration":o.fadeSpeed/1e3+"s",transform:"scale(0)",opacity:0}),setTimeout(function(){w.hide().trigger("poptrox_reset"),o.onPopupClose&&o.onPopupClose(),n.fadeOut(o.fadeSpeed,function(){d.css("width",""),i.add(r).css("overflow-y",""),s.css("left",""),g=!1})},o.fadeSpeed+10)}).trigger("poptrox_reset"),w.on("click",function(t){t.stopPropagation()}),b.find(o.selector).each(function(t){var e,i,n,a,r,d=$(this),s=d.find("img"),l=d.data("poptrox");if("ignore"!=l&&d.attr("href")){switch(e={src:d.attr("href"),captionText:s.attr("title"),width:null,height:null,type:null,object:null,options:null},o.caption?"function"==typeof o.caption?n=o.caption(d):"selector"in o.caption&&(a=d.find(o.caption.selector),"attribute"in o.caption?n=a.attr(o.caption.attribute):(n=a.html(),!0===o.caption.remove&&a.remove())):n=s.attr("title"),e.captionText=n,l&&(0 in(r=l.split(","))&&(e.type=r[0]),1 in r&&(i=r[1].match(/([0-9%]+)x([0-9%]+)/))&&3==i.length&&(e.width=i[1],e.height=i[2]),2 in r&&(e.options=r[2])),e.type||(e.type="image"),e.type){case"iframe":e.object=$("<iframe>",{allowfullscreen:!0,frameborder:0}),e.width&&e.height||(e.width=600,e.height=400);break;case"ajax":e.object=$(p,{class:"poptrox-ajax",css:{overflow:"auto"}}),e.width&&e.height||(e.width=600,e.height=400);break;case"video":e.object=$("<video>",{width:e.width,height:e.height,controlsList:"nodownload",controls:!0,autoplay:!0}),e.width&&e.height||(e.width=600,e.height=400);break;case"audio":e.object=$("<audio>",{css:{background:"url("+d.children("img").attr("src")+") center/cover",padding:20},controls:!0,autoplay:!0}),e.width&&e.height||(e.width=360,e.height=240);break;default:e.object=$("<img>",{css:{verticalAlign:"bottom"}}),e.width=d.attr("width"),e.height=d.attr("height")}"image"!=e.type&&e.object.on("click",function(t){t.stopPropagation()}).css({display:"block",cursor:"auto"}),c.push(e),s.removeAttr("title"),d.removeAttr("href").css("outline",0).on("click",function(e){e.preventDefault(),e.stopPropagation(),w.trigger("poptrox_open",[t])})}}),b.prop("_poptrox",o),b};