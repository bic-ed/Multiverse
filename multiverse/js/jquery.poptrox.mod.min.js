!function(e){e.fn.poptrox_disableSelection=function(){return e(this).css({"user-select":"none","-moz-user-select":"none","-webkit-user-select":"none"})},e.fn.poptrox=function(t){function o(){p=h.width(),n=h.height();var e=r.outerWidth(!0)-r.width(),t=r.outerHeight(!0)-r.height(),o=u.map(e=>e.src).indexOf(r.find(".pic").children().attr("src"));if(o>-1&&"image"!=u[o].type){var i=Math.min(p-2*a.windowMargin-e,u[o].width),s=Math.min(n-2*a.windowMargin-t,u[o].height),l=u[o].width/u[o].height,d=i,c=s;d=Math.round(Math.min(d,s*l)),c=Math.round(Math.min(c,i/l))}else d=p-2*a.windowMargin-e,c=n-2*a.windowMargin-t;r.css("min-width",a.popupWidth).css("min-height",a.popupHeight),w.children().css("max-width",d).css("max-height",c)}if(0==this.length)return e(this);if(this.length>1){for(var i=0;i<this.length;i++)e(this[i]).poptrox(t);return e(this)}var p,n,r,a=e.extend({baseZIndex:1e3,fadeSpeed:300,overlayColor:"#000000",overlayOpacity:.6,overlayClass:"poptrox-overlay",windowMargin:50,selector:"a",caption:null,parent:"body",popupSpeed:300,popupWidth:200,popupHeight:100,useBodyOverflow:!1,usePopupEasyClose:!0,usePopupForceClose:!1,usePopupLoader:!0,usePopupCloser:!0,usePopupCaption:!1,usePopupDefaultStyling:!0,popupBackgroundColor:"#FFFFFF",popupTextColor:"#000000",popupLoaderTextSize:"2em",popupCloserBackgroundColor:"#000000",popupCloserTextColor:"#FFFFFF",popupCloserTextSize:"20px",popupPadding:10,popupCaptionHeight:60,popupCaptionTextSize:null,popupBlankCaptionText:"(untitled)",popupCloserText:"&#215;",popupLoaderText:"&bull;&bull;&bull;&bull;",popupClass:"poptrox-popup",popupSelector:null,popupLoaderSelector:".loader",popupCloserSelector:".closer",popupCaptionSelector:".caption",onPopupClose:null,onPopupOpen:null},t),s=e(this),l=e("body"),d=e('<div class="'+a.overlayClass+'"></div>'),h=e(window),u=[],g=0,f=!1;new Array;a.usePopupLoader||(a.popupLoaderSelector=null),a.usePopupCloser||(a.popupCloserSelector=null),a.usePopupCaption||(a.popupCaptionSelector=null),r=a.popupSelector?e(a.popupSelector):e('<div class="'+a.popupClass+'">'+(a.popupLoaderSelector?'<div class="loader">'+a.popupLoaderText+"</div>":"")+'<div class="pic"></div>'+(a.popupCaptionSelector?'<div class="caption"></div>':"")+(a.popupCloserSelector?'<span class="closer">'+a.popupCloserText+"</span>":""));var w=r.find(".pic"),v=e(),x=r.find(a.popupLoaderSelector),y=r.find(a.popupCaptionSelector),C=r.find(a.popupCloserSelector);return h.on("resize orientationchange",function(){o()}),y.on("update",function(e,t){t&&0!=t.length||(t=a.popupBlankCaptionText),y.html(t)}),d.css({position:"fixed",left:0,top:0,"z-index":a.baseZIndex,width:"100%",height:"100%","text-align":"center",cursor:"pointer"}).appendTo(a.parent).prepend('<div style="display:inline-block;height:100%;vertical-align:middle;">').append('<div style="position:absolute;left:0;top:0;width:100%;height:100%;background:'+a.overlayColor+";opacity:"+a.overlayOpacity+'">').hide().on("touchmove",function(){return!1}),r.css({display:"inline-block","vertical-align":"middle",position:"relative","z-index":1,cursor:"auto"}).appendTo(d).hide().on("poptrox_next",function(){var e=g+1;e>=u.length&&(e=0),r.trigger("poptrox_switch",[e])}).on("poptrox_previous",function(){var e=g-1;e<0&&(e=u.length-1),r.trigger("poptrox_switch",[e])}).on("poptrox_reset",function(){o(),r.data("width",a.popupWidth).data("height",a.popupHeight),x.hide().trigger("stopSpinning"),y.hide(),C.hide(),w.hide(),v.attr("src","").detach()}).on("poptrox_open",function(e,t){if(f)return!0;f=!0,a.useBodyOverflow&&l.css("overflow","hidden"),a.onPopupOpen&&a.onPopupOpen(),r.addClass("loading"),d.fadeIn(a.fadeSpeed),r.trigger("poptrox_switch",[t,!0])}).on("poptrox_switch",function(t,i,p){var n;if(!p&&f)return!0;f=!0,r.removeClass("not-image").addClass("loading").css({width:r.data("width"),height:r.data("height")}),y.hide(),v.attr("src")&&v.attr("src",""),v.detach(),n=u[i],v=n.object,w.css("clip-path","inset(50%)").show().append(v),"ajax"==n.type?e.get(n.src,function(e){v.html(e),v.trigger("load")}):v.attr("src",n.src),"image"!=n.type&&(r.addClass("not-image"),v.css({position:"relative",outline:"0","z-index":a.baseZIndex+100,width:n.width,height:n.height})),x.trigger("startSpinning").fadeIn(300),r.show(),v.one("load",function(){o(),x.hide().trigger("stopSpinning");var e=v.width(),t=v.height(),p=function(){y.trigger("update",[n.captionText]).fadeIn(a.fadeSpeed),C.fadeIn(a.fadeSpeed),l&&v.css({height:"auto","aspect-ratio":l}),w.css({"clip-path":"none","aspect-ratio":s}).hide().fadeIn(a.fadeSpeed,function(){f=!1}),g=i,r.removeClass("loading").data({width:e,height:t}).css({width:"auto",height:"auto"})};s&&(e=v.outerWidth(),t=v.outerHeight(),v.css("height","100%")),e==r.data("width")&&t==r.data("height")?p():r.animate({width:e,height:t},a.popupSpeed,"swing",p)});var s="",l="";if("video"==n.type||"audio"==n.type){var d=n.width+"/"+n.height;"video"==n.type?l=d:s=d,v.one("canplay",function(){v.trigger("load")})}}).on("poptrox_close",function(){if(f&&!a.usePopupForceClose)return!0;f=!0,r.css({"transition-duration":a.fadeSpeed/1e3+"s",transform:"scale(0)",opacity:0}),setTimeout(function(){r.hide().trigger("poptrox_reset"),a.onPopupClose&&a.onPopupClose(),d.fadeOut(a.fadeSpeed,function(){a.useBodyOverflow&&l.css("overflow","auto"),f=!1})},a.fadeSpeed+10)}).trigger("poptrox_reset"),r.on("click",function(e){e.stopPropagation()}),s.find(a.selector).each(function(t){var o,i,p=e(this),n=p.find("img"),s=p.data("poptrox");if("ignore"!=s&&p.attr("href")){if(o={src:p.attr("href"),captionText:n.attr("title"),width:null,height:null,type:null,object:null,options:null},a.caption){if("function"==typeof a.caption)c=a.caption(p);else if("selector"in a.caption){var l;l=p.find(a.caption.selector),"attribute"in a.caption?c=l.attr(a.caption.attribute):(c=l.html(),!0===a.caption.remove&&l.remove())}}else c=n.attr("title");if(o.captionText=c,s){var d=s.split(",");0 in d&&(o.type=d[0]),1 in d&&(i=d[1].match(/([0-9%]+)x([0-9%]+)/),i&&3==i.length&&(o.width=i[1],o.height=i[2])),2 in d&&(o.options=d[2])}switch(o.type||(o.type="image"),o.type){case"iframe":o.object=e('<iframe src="" allowfullscreen frameborder="0"></iframe>'),o.width&&o.height||(o.width="600",o.height="400");break;case"ajax":o.object=e('<div class="poptrox-ajax"></div>'),o.object.css("overflow","auto"),o.width&&o.height||(o.width="600",o.height="400");break;case"video":o.object=e("<video width="+o.width+' height="'+o.height+'" src="" controls controlsList="nodownload" autoplay>'),o.width&&o.height||(o.width="600",o.height="400");break;case"audio":o.object=e('<audio src="" controls autoplay>'),o.object.css({background:"url("+p.children("img").attr("src")+") center/cover",padding:20}),o.width&&o.height||(o.width="360",o.height="240");break;default:o.object=e('<img src="" alt="" style="vertical-align:bottom" />'),o.width=p.attr("width"),o.height=p.attr("height")}"image"!=o.type&&o.object.on("click",function(e){e.stopPropagation()}).css({display:"block",cursor:"auto"}),u.push(o),n.removeAttr("title"),p.removeAttr("href").css("outline",0).on("click",function(e){e.preventDefault(),e.stopPropagation(),r.trigger("poptrox_open",[t])})}}),s.prop("_poptrox",a),s}}(jQuery);